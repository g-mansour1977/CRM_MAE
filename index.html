<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Mini Prototype MAE ‚Äì CRM & Gestion des Missions</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Librairies -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <style>
    body {font-family: Arial, sans-serif; background:#f4f6f9; margin:0;}
    header {background:#0a3d62; color:#fff; padding:15px; text-align:center;}
    nav {display:flex; background:#1e3799;}
    nav button {flex:1; padding:12px; border:none; background:#1e3799; color:white; cursor:pointer; font-weight:bold;}
    nav button:hover {background:#4a69bd;}
    section {display:none; padding:20px;}
    section.active {display:block;}
    .card {background:#fff; padding:15px; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,0.1); margin-bottom:15px;}
    input, select, textarea {width:100%; padding:8px; margin-bottom:10px;}
    button.action {background:#0a3d62; color:#fff; padding:10px; border:none; border-radius:5px; cursor:pointer; margin-right:5px;}
    table {width:100%; border-collapse:collapse;}
    th, td {border:1px solid #ccc; padding:8px;}
    th {background:#dff9fb;}
  </style>
</head>

<body>

<header>
  <h2>R√âPUBLIQUE DU S√âN√âGAL</h2>
  <p>Un Peuple ‚Äì Un But ‚Äì Une Foi</p>
  <h3>MINIST√àRE DES AFFAIRES √âTRANG√àRES</h3>
  <p><strong>Prototype ‚Äì CRM & Gestion Administrative</strong></p>
</header>

<nav>
  <button onclick="showSection('crm')">CRM Interne</button>
  <button onclick="showSection('missions')">Missions</button>
  <button onclick="showSection('demandes')">Demandes</button>
</nav>

<!-- CRM -->
<section id="crm" class="active">
  <div class="card">
    <h3>üìÇ CRM Interne</h3>
    <input id="crm_service" placeholder="Direction / Service">
    <input id="crm_objet" placeholder="Objet de la demande">
    <select id="crm_statut">
      <option>En cours</option>
      <option>Trait√©</option>
      <option>En attente</option>
    </select>

    <button class="action" onclick="addCRM()">Soumettre la demande</button>
    <button class="action" onclick="exportExcel('crm_table')">Exporter Excel</button>
    <button class="action" onclick="exportPDF('CRM Interne','crm_table')">PDF officiel</button>
  </div>

  <table id="crm_table">
    <tr><th>Service</th><th>Objet</th><th>Statut</th></tr>
  </table>
</section>

<!-- MISSIONS -->
<section id="missions">
  <div class="card">
    <h3>‚úàÔ∏è Gestion des Missions</h3>
    <input id="m_nom" placeholder="Nom de l‚Äôagent">
    <input id="m_matricule" placeholder="Matricule">
    <input id="m_dest" placeholder="Destination">
    <input id="m_date" placeholder="Dates (Du - Au)">
    <select id="m_type">
      <option>Ordre de mission</option>
      <option>√âtat de mission</option>
    </select>

    <button class="action" onclick="addMission()">Soumettre la mission</button>
    <button class="action" onclick="exportExcel('mission_table')">Exporter Excel</button>
    <button class="action" onclick="exportPDF('Missions','mission_table')">PDF officiel</button>
  </div>

  <table id="mission_table">
    <tr>
      <th>Agent</th>
      <th>Matricule</th>
      <th>Destination</th>
      <th>Dates</th>
      <th>Type</th>
    </tr>
  </table>
</section>

<!-- DEMANDES -->
<section id="demandes">
  <div class="card">
    <h3>üìù Demandes Administratives</h3>
    <select id="d_type">
      <option>Fournitures</option>
      <option>Carburant</option>
      <option>Bon de commande</option>
    </select>
    <textarea id="d_desc" placeholder="Description de la demande"></textarea>

    <button class="action" onclick="addDemande()">Soumettre</button>
  </div>

  <table id="demande_table">
    <tr><th>Type</th><th>Description</th></tr>
  </table>
</section>

<script>
/* Navigation */
function showSection(id){
  document.querySelectorAll("section").forEach(s=>s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
}

/* CRM */
function addCRM(){
  crm_table.innerHTML += `
    <tr>
      <td>${crm_service.value}</td>
      <td>${crm_objet.value}</td>
      <td>${crm_statut.value}</td>
    </tr>`;
}

/* Missions */
function addMission(){
  mission_table.innerHTML += `
    <tr>
      <td>${m_nom.value}</td>
      <td>${m_matricule.value}</td>
      <td>${m_dest.value}</td>
      <td>${m_date.value}</td>
      <td>${m_type.value}</td>
    </tr>`;
}

/* Demandes */
function addDemande(){
  demande_table.innerHTML += `
    <tr>
      <td>${d_type.value}</td>
      <td>${d_desc.value}</td>
    </tr>`;
}

/* Export Excel */
function exportExcel(tableId){
  let wb = XLSX.utils.book_new();
  let ws = XLSX.utils.table_to_sheet(document.getElementById(tableId));
  XLSX.utils.book_append_sheet(wb, ws, "Donn√©es");
  XLSX.writeFile(wb, tableId + ".xlsx");
}

/* Export PDF officiel */
function exportPDF(title, tableId){
  const { jsPDF } = window.jspdf;
  let pdf = new jsPDF("l","mm","a4");

  pdf.setFontSize(14);
  pdf.text("MINIST√àRE DES AFFAIRES √âTRANG√àRES ‚Äì S√âN√âGAL", 10, 15);
  pdf.setFontSize(12);
  pdf.text(title, 10, 25);

  let y = 35;
  document.querySelectorAll(`#${tableId} tr`).forEach(row=>{
    let x = 10;
    row.querySelectorAll("th,td").forEach(cell=>{
      pdf.text(cell.innerText, x, y);
      x += 40;
    });
    y += 8;
  });

  pdf.save(title + ".pdf");
}
</script>

</body>
</html>
