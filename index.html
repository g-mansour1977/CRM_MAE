<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Prototype MAE ‚Äì CRM, Missions & Tableau de Bord</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    body {font-family: Arial, sans-serif; background:#f4f6f9; margin:0;}
    header {background:#0a3d62; color:#fff; padding:15px; text-align:center;}
    nav {display:flex; background:#1e3799;}
    nav button {flex:1; padding:12px; border:none; background:#1e3799; color:white; cursor:pointer; font-weight:bold;}
    nav button:hover {background:#4a69bd;}
    section {display:none; padding:20px;}
    section.active {display:block;}
    .card {background:#fff; padding:15px; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,0.1); margin-bottom:15px;}
    input, select, textarea {width:100%; padding:8px; margin-top:5px; margin-bottom:10px;}
    button.action {background:#0a3d62; color:#fff; padding:10px; border:none; border-radius:5px; cursor:pointer; margin-right:5px;}
    table {width:100%; border-collapse:collapse;}
    th, td {border:1px solid #ccc; padding:8px;}
    th {background:#dff9fb;}
  </style>
</head>
<body>

<header>
  <h2>R√âPUBLIQUE DU S√âN√âGAL</h2>
  <p>Un Peuple ‚Äì Un But ‚Äì Une Foi</p>
  <hr style="border:1px solid #fff; width:60%">
  <h3>MINIST√àRE DES AFFAIRES √âTRANG√àRES</h3>
  <p><strong>Direction de l‚ÄôAdministration G√©n√©rale et de l‚Äô√âquipement (DAGE)</strong></p>
  <p style="font-size:14px">
    Plateforme interne de gestion administrative ‚Äì Prototype de d√©monstration
  </p>
</header>

<nav>
  <button onclick="showSection('crm')">CRM</button>
  <button onclick="showSection('missions')">Missions</button>
  <button onclick="showSection('stats')">Tableau de bord</button>
</nav>

<section id="crm" class="active">
  <div class="card">
    <h3>üìÇ CRM Interne</h3>
    <label>Direction / Service</label>
    <input id="crm_service" placeholder="Direction / Service" />
    <label>Objet de la demande</label>
    <input id="crm_objet" placeholder="Objet de la demande" />
    <label>Statut</label>
    <select id="crm_statut"><option>En cours</option><option>Trait√©</option><option>En attente</option></select>
    <button class="action" onclick="addCRM()">Ajouter</button>
    <button class="action" onclick="exportExcel('crm_table')">Exporter Excel</button>
    <button class="action" onclick="exportPDF('CRM Interne','crm_table')">PDF officiel</button>
  </div>
  <table id="crm_table"><tr><th>Service</th><th>Objet</th><th>Statut</th></tr></table>
</section>

<section id="missions">
  <div class="card">
    <h3>‚úàÔ∏è Gestion des Missions</h3>
    <input id="m_nom" placeholder="Nom de l'agent" />
    <input id="m_dest" placeholder="Destination" />
    <input id="m_date" placeholder="Dates" />
    <button class="action" onclick="addMission()">Ajouter</button>
    <button class="action" onclick="exportExcel('mission_table')">Exporter Excel</button>
    <button class="action" onclick="exportPDF('Ordre / √âtat de Mission','mission_table')">PDF officiel</button>
  </div>
  <table id="mission_table"><tr><th>Agent</th><th>Destination</th><th>Dates</th><th>Ordre de Mission</th></tr></table>
</section>

<section id="stats">
  <div class="card">
    <h3>üìä Tableau de bord</h3>
    <p id="stat_crm"></p>
    <p id="stat_mission"></p>
  </div>
</section>


<script>

const SCRIPT_URL = "https://script.google.com/macros/s/AKfycby4JDzlNqGoADg1FJ8sKvklFbuNSwHsERsSQ0u6MU2cvxlOR7eB0EujjsOe2XhHH_LM/exec";

function showSection(id){
document.querySelectorAll("section").forEach(s=>s.classList.remove("active"));
document.getElementById(id).classList.add("active");
updateStats();
}

function addCRM(){
const data = {
service: crm_service.value,
objet: crm_objet.value,
statut: crm_statut.value
};

if(!data.service || !data.objet){
alert("Champs obligatoires manquants");
return;
}

fetch(SCRIPT_URL,{
 method:"POST",
  headers:{"Content-Type":"application/json"},
  body:JSON.stringify(data)
})
.then(res => res.json())
.then(r => {
  if(r.success){
    alert("Demande enregistr√©e\nR√©f√©rence : " + r.reference);
  } else {
    alert("Erreur : " + r.message);
  }
})
.catch(err => alert("Erreur serveur"));
}

function addMission(){
mission_table.innerHTML += `
<tr>
<td>${m_nom.value}</td>
<td>${m_dest.value}</td>
<td>${m_date.value}</td>
<td>${m_type.value}</td>
</tr>`;
updateStats();
}


function showSection(id){document.querySelectorAll('section').forEach(s=>s.classList.remove('active'));document.getElementById(id).classList.add('active');updateStats();}

function addCRM(){crm_table.innerHTML+=`<tr><td>${crm_service.value}</td><td>${crm_objet.value}</td><td>${crm_statut.value}</td></tr>`;updateStats();}
function addMission(){mission_table.innerHTML+=`<tr><td>${m_nom.value}</td><td>${m_dest.value}</td><td>${m_date.value}</td></tr>`;updateStats();}

function exportExcel(tableId){let wb=XLSX.utils.book_new();let ws=XLSX.utils.table_to_sheet(document.getElementById(tableId));XLSX.utils.book_append_sheet(wb,ws,"Donn√©es");XLSX.writeFile(wb,tableId+'.xlsx');}

function exportPDF(title,tableId){const {jsPDF}=window.jspdf;let pdf=new jsPDF();pdf.text(title,10,10);pdf.text('Minist√®re des Affaires √âtrang√®res ‚Äì S√©n√©gal',10,18);let y=30;document.querySelectorAll(`#${tableId} tr`).forEach(r=>{let x=10;r.querySelectorAll('td,th').forEach(c=>{pdf.text(c.innerText,x,y);x+=60;});y+=8;});pdf.save(title+'.pdf');}

function updateStats(){stat_crm.innerText="Nombre total de demandes CRM : "+(crm_table.rows.length-1);stat_mission.innerText="Nombre total de missions : "+(mission_table.rows.length-1);}
</script>

</body>
</html>
